function removeAllCanvasObjects(a){for(var b in Main.objects[a])Main.canvas.remove(Main.objects[a][b].element)}function addAllCanvasObjects(a){for(var b in Main.objects[a])Main.canvas.add(Main.objects[a][b].element);Main.generateTruthTable()}function removeAllObjects(a){for(var b in Main.objects[a])Main.canvas.remove(Main.objects[a][b].element),delete Main.objects[a][b]}var Constants=function(){var a={};return a.TYPES={INPUT_GATE:0,OUTPUT_GATE:1,AND_GATE:2,NAND_GATE:3,OR_GATE:4,NOR_GATE:5,XOR_GATE:6,NXOR_GATE:7,NOT_GATE:8,HORIZONTAL_LINE:9,VERTICAL_LINE:10},a.TYPE_NAMES=["Input Gate","Output Gate","And Gate","Nand Gate","Or Gate","Nor Gate","Xor Gate","Nxor Gate","Not Gate","Horizontal Line","Vertical Line"],a.OPTS={height:50*Math.round((window.innerHeight-145)/50),width:50*Math.round((window.outerWidth-332)/50),gridSize:50,initialObjectId:11},a.STATES={INPUT_ON:"img/input_gate_on.png",INPUT_OFF:"img/input_gate_off.png",OUTPUT_ON:"img/output_gate_on.png",OUTPUT_OFF:"img/output_gate_off.png"},a.GATES=[{url:a.STATES.INPUT_OFF,id:a.TYPES.INPUT_GATE,type:a.TYPES.INPUT_GATE},{url:a.STATES.OUTPUT_OFF,id:a.TYPES.OUTPUT_GATE,type:a.TYPES.OUTPUT_GATE},{url:"img/and_gate.png",id:a.TYPES.AND_GATE,type:a.TYPES.AND_GATE},{url:"img/nand_gate.png",id:a.TYPES.NAND_GATE,type:a.TYPES.NAND_GATE},{url:"img/or_gate.png",id:a.TYPES.OR_GATE,type:a.TYPES.OR_GATE},{url:"img/nor_gate.png",id:a.TYPES.NOR_GATE,type:a.TYPES.NOR_GATE},{url:"img/xor_gate.png",id:a.TYPES.XOR_GATE,type:a.TYPES.XOR_GATE},{url:"img/nxor_gate.png",id:a.TYPES.NXOR_GATE,type:a.TYPES.NXOR_GATE},{url:"img/not_gate.png",id:a.TYPES.NOT_GATE,type:a.TYPES.NOT_GATE}],a}(),Main=function(a){var b=function(a,b){if(0==a.length)return void $("#truth-table-content").text("\\begin{array}{}\\\\\\hline \\\\\\end{array}");for(var c="\\begin{array}{",d=0;d<a[0].length;d++)c+=0==d?"C":"|C";c+="}";for(var d=0;d<a[0].length;d++)0!=d&&(c+="&"),c+=b>d?String.fromCharCode(65+d):String.fromCharCode(88+d-b);c+="\\\\\\hline ";for(var d=0;d<a.length;d++){for(var e=0;e<a[d].length;e++)0!=e&&(c+="&"),c+=a[d][e]?"T":"F";c+="\\\\"}c+="\\end{array}",$("#truth-table-content").text(c),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"truth-table"])},c={};return c.currObjectId=a.OPTS.initialObjectId,c.currTab=0,c.canvas=null,c.objects=[{}],c.initApp=function(){c.canvas=new fabric.Canvas("editor"),c.canvas.setWidth(a.OPTS.width),c.canvas.setHeight(a.OPTS.height),c.canvas.selection=!1,c.canvas.hoverCursor="default",c.canvas.moveCursor="default";for(var b=1;b<a.OPTS.width/a.OPTS.gridSize;b++)c.canvas.add(new fabric.Line([b*a.OPTS.gridSize,0,b*a.OPTS.gridSize,a.OPTS.height],{stroke:"#373b41",selectable:!1}));for(var b=1;b<a.OPTS.height/a.OPTS.gridSize;b++)c.canvas.add(new fabric.Line([a.OPTS.gridSize,b*a.OPTS.gridSize,a.OPTS.width,b*a.OPTS.gridSize],{stroke:"#373b41",selectable:!1}));for(var b=0;b<a.GATES.length;b++){var d=a.GATES[b];fabric.Image.fromURL(d.url,function(a){c.canvas.add(a)},{id:d.id,selectable:!1,isToolbox:!0,top:b*a.OPTS.gridSize,height:a.OPTS.gridSize,width:a.OPTS.gridSize})}},c.getGate=function(b){return a.TYPE_NAMES[b]},c.updateJsonOutput=function(){for(var a=0;a<c.objects.length;a++)for(var b in c.objects[a]){var d=c.objects[a][b].element;c.objects[a][b].x1=d.x1,c.objects[a][b].x2=d.x2,c.objects[a][b].y1=d.y1,c.objects[a][b].y2=d.y2}$("#export-modal-textarea").val(JSON.stringify(c.objects))},c.isGate=function(a){return 8>=a},c.isEditableObject=function(b){return b>=a.OPTS.initialObjectId},c.updateCost=function(){var b=0;for(var d in c.objects[c.currTab]){var e=c.objects[c.currTab][d];e.type==a.TYPES.NOT_GATE?(0==e.inputs.length||c.objects[c.currTab][e.inputs[0]].type!=a.TYPES.OUTPUT_GATE)&&(b+=1):e.type!=a.TYPES.INPUT_GATE&&e.type!=a.TYPES.OUTPUT_GATE&&c.isGate(e.type)&&(b+=1+c.objects[c.currTab][d].inputs.length)}$("#circuit-cost").text("Cost: "+b+".")},c.wireObjects=function(b,d,e){var f=c.objects[e][b],g=c.objects[e][d],h=f.left,i=g.left+a.OPTS.gridSize,j=f.top+a.OPTS.gridSize/2;f.type!=a.TYPES.OUTPUT_GATE&&(j=f.top+10+Math.min(30,5*f.inputs.length));var k=g.top+a.OPTS.gridSize/2,l=new fabric.Line([h,j,(h+i)/2,j],{stroke:"#81a2be",selectable:!1,id:c.currObjectId++,strokeWidth:3}),m=new fabric.Line([(h+i)/2,j,(h+i)/2,k],{stroke:"#81a2be",selectable:!0,hasControls:!1,id:c.currObjectId++,strokeWidth:3}),n=new fabric.Line([i,k,(h+i)/2,k],{stroke:"#81a2be",selectable:!1,id:c.currObjectId++,strokeWidth:3}),o={element:l,type:a.TYPES.HORIZONTAL_LINE,outputs:[],inputs:[]},p={element:n,type:a.TYPES.HORIZONTAL_LINE,outputs:[],inputs:[]},q={element:m,type:a.TYPES.VERTICAL_LINE,y1:j,y2:k,outputs:[],inputs:[]};o.outputs.push(b),o.inputs.push(q.element.id),q.outputs.push(o.element.id),q.inputs.push(p.element.id),p.outputs.push(q.element.id),p.inputs.push(d),c.objects[e][b].inputs.push(o.element.id),c.objects[e][d].outputs.push(p.element.id),c.objects[e][o.element.id]=o,c.objects[e][p.element.id]=p,c.objects[e][q.element.id]=q},c.getOutput=function(b,d){if(!b)return 0;if(b.type==a.TYPES.INPUT_GATE)return d?d[b.element.id]:b.state==a.STATES.INPUT_ON;if(0==b.inputs.length)return 0;if(b.type==a.TYPES.HORIZONTAL_LINE||b.type==a.TYPES.VERTICAL_LINE){var e=c.getOutput(c.objects[c.currTab][b.inputs[0]],d);d||b.element.setStroke(e?"#22A80C":"#81a2be")}else if(b.type==a.TYPES.AND_GATE||b.type==a.TYPES.NAND_GATE){for(var e=1,f=0;f<b.inputs.length;f++)e&=c.getOutput(c.objects[c.currTab][b.inputs[f]],d);b.type==a.TYPES.NAND_GATE&&(e=!e)}else if(b.type==a.TYPES.OR_GATE||b.type==a.TYPES.NOR_GATE){for(var e=0,f=0;f<b.inputs.length;f++)e|=c.getOutput(c.objects[c.currTab][b.inputs[f]],d);b.type==a.TYPES.NOR_GATE&&(e=!e)}else if(b.type==a.TYPES.XOR_GATE||b.type==a.TYPES.NXOR_GATE){for(var e=0,f=0;f<b.inputs.length;f++)e^=c.getOutput(c.objects[c.currTab][b.inputs[f]],d);b.type==a.TYPES.NXOR_GATE&&(e=!e)}else if(b.type==a.TYPES.NOT_GATE){var e=0;b.inputs.length>0&&(e=!c.getOutput(c.objects[c.currTab][b.inputs[0]],d))}return e},c.updateOutputs=function(){for(var b in c.objects[c.currTab]){var d=c.objects[c.currTab][b];if(d.type==a.TYPES.OUTPUT_GATE){var e=a.STATES.OUTPUT_OFF;d.inputs.length>0&&(e=1==c.getOutput(c.objects[c.currTab][d.inputs[0]],null)?a.STATES.OUTPUT_ON:a.STATES.OUTPUT_OFF),d.element.setSrc(e,function(){c.canvas.renderAll()})}}},c.generateTruthTable=function(){var d=[],e=[];for(var f in c.objects[c.currTab])c.objects[c.currTab][f].type==a.TYPES.INPUT_GATE?d.push(c.objects[c.currTab][f].element.id):c.objects[c.currTab][f].type==a.TYPES.OUTPUT_GATE&&e.push(c.objects[c.currTab][f].element.id);d.sort(),e.sort();for(var g={},h=[],i=0;i<1<<d.length;i++){h.push(new Array(d.length+e.length));for(var j=0;j<d.length;j++)g[d[j]]=(i&1<<j)>0?1:0,h[i][j]=(i&1<<j)>0?1:0;for(var j=0;j<e.length;j++)0==c.objects[c.currTab][e[j]].inputs.length?h[i][d.length+j]=0:h[i][d.length+j]=c.getOutput(c.objects[c.currTab][c.objects[c.currTab][e[j]].inputs[0]],g)}return b(h,d.length),h},c}(Constants),CanvasEvents=function(a,b){var c,d,e,f,g,h,i=!1,j=!1,k=!1,l=!1,m=[],n=function(c,d,e,f,g,h){if(2!=f&&e)for(var i=0;i<e.inputs.length;i++){var j=b.objects[b.currTab][e.inputs[i]],k=j.element.x2,l=j.element.y2;j.type==a.TYPES.HORIZONTAL_LINE?Math.abs(j.element.x2-g)<1e-6?(j.element.set({y1:j.element.y1+d,y2:j.element.y2+d,x2:j.element.x2+c}),j.element.setCoords()):(j.element.set({y1:j.element.y1+d,y2:j.element.y2+d,x1:j.element.x1+c}),j.element.setCoords()):j.type==a.TYPES.VERTICAL_LINE&&(Math.abs(j.element.y2-h)<1e-6?(j.element.set({y2:j.element.y2+d}),j.element.setCoords()):(j.element.set({y1:j.element.y1+d}),j.y1=j.element.y1,j.y2=j.element.y2,j.element.setCoords())),n(c,d,j,f+1,k,l)}},o=function(c,d,e,f,g,h){if(2!=f&&e)for(var i=0;i<e.outputs.length;i++){var j=b.objects[b.currTab][e.outputs[i]],k=j.element.x2,l=j.element.y2;j.type==a.TYPES.HORIZONTAL_LINE?Math.abs(j.element.x2-g)<1e-6?(j.element.set({y1:j.element.y1+d,y2:j.element.y2+d,x2:j.element.x2+c}),j.element.setCoords()):(j.element.set({y1:j.element.y1+d,y2:j.element.y2+d,x1:j.element.x1+c}),j.element.setCoords()):j.type==a.TYPES.VERTICAL_LINE&&(Math.abs(j.element.y2-h)<1e-6?(j.element.set({y2:j.element.y2+d}),j.element.setCoords()):(j.element.set({y1:j.element.y1+d}),j.y1=j.element.y1,j.y2=j.element.y2,j.element.setCoords())),o(c,d,j,f+1,k,l)}},p=function(c){var d=[];for(var e in b.objects[b.currTab])b.objects[b.currTab][e].type==a.TYPES.INPUT_GATE&&d.push(b.objects[b.currTab][e].element.id);d.sort();for(var f=0;f<d.length;f++)if(d[f]==c)return String.fromCharCode(65+f)},q=function(c){var d=[];for(var e in b.objects[b.currTab])b.objects[b.currTab][e].type==a.TYPES.OUTPUT_GATE&&d.push(b.objects[b.currTab][e].element.id);d.sort();for(var f=0;f<d.length;f++)if(d[f]==c)return String.fromCharCode(88+f)},r=function(a,c){if(4!=c&&a&&a.element){for(var d=0;d<a.inputs.length;d++){var e=b.objects[b.currTab][a.inputs[d]],f=e.outputs.indexOf(a.element.id);e.outputs.splice(f),r(e,c+1)}for(var d=0;d<a.outputs.length;d++){var g=b.objects[b.currTab][a.outputs[d]],f=g.inputs.indexOf(a.element.id);g.inputs.splice(f),r(g,c+1)}b.canvas.remove(a.element),delete b.objects[b.currTab][a.element.id]}};return{onMouseOver:function(c){if(c.target&&b.isEditableObject(c.target.id)){var d=c.target.id;j?(r(b.objects[b.currTab][d],0),b.updateJsonOutput(),b.updateCost()):b.objects[b.currTab][d]&&(b.objects[b.currTab][d].type==a.TYPES.INPUT_GATE?$("#current-hovered-element").text("Hovered: Input Gate: "+p(d)+"."):b.objects[b.currTab][d].type==a.TYPES.OUTPUT_GATE?$("#current-hovered-element").text("Hovered: Output Gate: "+q(d)+"."):$("#current-hovered-element").text("Hovered: "+b.getGate(b.objects[b.currTab][d].type)+"."))}else $("#current-hovered-element").text("Hovered: No element.")},onMouseUp:function(f){if((new Date).getTime()-h<100)if(f.target&&f.target.isToolbox){var g=a.GATES[f.target.id];fabric.Image.fromURL(g.url,function(c){b.canvas.add(c),b.objects[b.currTab][c.id]={element:c,type:g.type,outputs:[],inputs:[],top:g.id*a.OPTS.gridSize,left:a.OPTS.gridSize,width:a.OPTS.gridSize,height:a.OPTS.gridSize,state:a.STATES.INPUT_OFF},b.generateTruthTable(),b.updateJsonOutput(),b.updateCost()},{id:b.currObjectId++,top:g.id*a.OPTS.gridSize,left:a.OPTS.gridSize,height:a.OPTS.gridSize,width:a.OPTS.gridSize,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1})}else if(f.target&&b.objects[b.currTab][f.target.id]&&b.objects[b.currTab][f.target.id].type==a.TYPES.INPUT_GATE){var g=b.objects[b.currTab][f.target.id];g.state=g.state==a.STATES.INPUT_ON?a.STATES.INPUT_OFF:a.STATES.INPUT_ON,g.element.setSrc(g.state,function(){b.canvas.renderAll()}),b.updateOutputs(),b.updateJsonOutput(),b.updateCost()}if(c&&d&&e&&i){var j=d.element.x2,m=d.element.y2,n=!1;b.objects[b.currTab][c.element.id]=c,b.objects[b.currTab][d.element.id]=d,b.objects[b.currTab][e.element.id]=e;for(var o in b.objects[b.currTab]){var g=b.objects[b.currTab][o];if(b.isGate(g.type)&&g.element.left-10<=j&&j<=g.element.left+10&&g.element.top<=m&&m<=g.element.top+50){if(g.type==a.TYPES.INPUT_GATE)continue;if(l)continue;d.outputs.push(g.element.id),g.inputs.push(d.element.id),d.element.set({x2:g.element.left}),d.element.setCoords(),n=!0,b.updateOutputs(),b.canvas.renderAll(),b.updateJsonOutput(),b.updateCost()}if(b.isGate(g.type)&&g.element.left+40<=j&&j<=g.element.left+60&&g.element.top+20<=m&&m<=g.element.top+30){if(g.type==a.TYPES.OUTPUT_GATE)continue;if(k)continue;d.inputs.push(g.element.id),1==d.outputs.length&&(Math.abs(b.objects[b.currTab][d.outputs[0]].element.y1-d.element.y2)<1e-6&&(b.objects[b.currTab][d.outputs[0]].element.set({y1:g.element.top+25}),b.objects[b.currTab][d.outputs[0]].element.setCoords()),Math.abs(b.objects[b.currTab][d.outputs[0]].element.y2-d.element.y2)<1e-6&&(b.objects[b.currTab][d.outputs[0]].element.set({y2:g.element.top+25}),b.objects[b.currTab][d.outputs[0]].element.setCoords())),g.outputs.push(d.element.id),d.element.set({x2:g.element.left+50,y1:g.element.top+25,y2:g.element.top+25}),d.element.setCoords(),n=!0,updateOutputs(),b.canvas.renderAll(),b.updateJsonOutput(),b.updateCost()}}if(b.updateJsonOutput(),b.updateCost(),!n){for(var p=0;p<c.inputs.length;p++)1==b.objects[b.currTab][c.inputs[p]].outputs.length&&b.objects[b.currTab][b.objects[b.currTab][c.inputs[p]].outputs[0]]==c&&(b.objects[b.currTab][c.inputs[p]].outputs=[]);1==c.outputs.length&&(b.objects[b.currTab][c.outputs[0]].inputs=b.objects[b.currTab][c.outputs[0]].inputs.filter(function(a){return b.objects[b.currTab][a].element.id!=c.element.id})),b.canvas.remove(c.element),b.canvas.remove(d.element),b.canvas.remove(e.element),delete b.objects[b.currTab][c.element.id],delete b.objects[b.currTab][d.element.id],delete b.objects[b.currTab][e.element.id]}c=null,d=null,e=null,b.generateTruthTable()}i=!1,k=!1,l=!1},onObjectMoving:function(c){if(b.isGate(b.objects[b.currTab][c.target.id].type)){var d=b.objects[b.currTab][c.target.id].left,e=b.objects[b.currTab][c.target.id].top,f=Math.round(c.target.left/a.OPTS.gridSize)*a.OPTS.gridSize,g=Math.round(c.target.top/a.OPTS.gridSize)*a.OPTS.gridSize;c.target.set({left:f,top:g}),c.target.setCoords(),b.objects[b.currTab][c.target.id].left=f,b.objects[b.currTab][c.target.id].top=g,n(f-d,g-e,b.objects[b.currTab][c.target.id],0,d,e),o(f-d,g-e,b.objects[b.currTab][c.target.id],0,d+50,e),b.canvas.renderAll(),b.updateJsonOutput(),b.updateCost()}else{var h=b.objects[b.currTab][c.target.id].y1,i=b.objects[b.currTab][c.target.id].y2,j=b.objects[b.currTab][c.target.id],k=b.objects[b.currTab][b.objects[b.currTab][j.inputs[0]].element.id],l=b.objects[b.currTab][b.objects[b.currTab][j.outputs[0]].element.id];Math.abs(k.element.x1-c.target.x1)<1e-6?k.element.set({x1:c.target.left}):k.element.set({x2:c.target.left}),Math.abs(l.element.x1-c.target.x1)<1e-6?l.element.set({x1:c.target.left}):l.element.set({x2:c.target.left}),c.target.set({y1:h,y2:i,x1:c.target.left,x2:c.target.left}),c.target.setCoords(),k.element.setCoords(),l.element.setCoords(),b.canvas.renderAll()}},onMouseMove:function(h){if(i){var j=b.canvas.getPointer(h.e),k=j.x,l=j.y;c.element.set({x1:f,x2:(k+f)/2,y1:g,y2:g}),e.element.set({x1:(k+f)/2,x2:(k+f)/2,y1:g,y2:l}),d.element.set({x1:(k+f)/2,x2:k,y1:l,y2:l}),e.y1=e.element.y1,e.y2=e.element.y2,c.element.setCoords(),d.element.setCoords(),e.element.setCoords(),b.canvas.renderAll()}for(var j=b.canvas.getPointer(h.e),n=j.x,o=j.y;m.length>0;)b.canvas.remove(m.pop());for(var p in b.objects[b.currTab]){var q=b.objects[b.currTab][p].element,r=q.left-15<=n&&n<=q.left&&q.top+5<=o&&o<=q.top+45,s=q.left+50<=n&&n<=q.left+65&&q.top<=o&&o<=q.top+50;if(s&&b.objects[b.currTab][p].type!=a.TYPES.OUTPUT_GATE&&b.isGate(b.objects[b.currTab][p].type)){var t=q.left,u=q.top+25,v=new fabric.Circle({radius:5,top:u-3.5,left:t+48,fill:"#81a2be",opacity:.8,selectable:!1});m.push(v),b.canvas.add(v)}else if(r&&b.objects[b.currTab][p].type!=a.TYPES.INPUT_GATE&&b.isGate(b.objects[b.currTab][p].type)){var t=q.left,u=o,v=new fabric.Circle({radius:5,top:u-3.5,left:t-6,fill:"#81a2be",opacity:.8,selectable:!1});m.push(v),b.canvas.add(v)}}},onMouseDown:function(j){if(h=(new Date).getTime(),!i)for(var m in b.objects[b.currTab]){var n=b.objects[b.currTab][m].element,o=b.canvas.getPointer(j.e),p=o.x,q=o.y;if(b.isGate(b.objects[b.currTab][m].type)){var r=n.left-10<=p&&p<=n.left&&n.top<=q&&q<=n.top+n.height,s=n.left+50<=p&&p<=n.left+60&&n.top+20<=q&&q<=n.top+30;if(r||s){if(s&&b.objects[b.currTab][m].type==a.TYPES.OUTPUT_GATE)continue;if(r&&b.objects[b.currTab][m].type==a.TYPES.INPUT_GATE)continue;s&&b.objects[b.currTab][m].type==a.TYPES.INPUT_GATE&&(k=!0),r&&b.objects[b.currTab][m].type==a.TYPES.OUTPUT_GATE&&(l=!0),i=!0,f=n.left,g=q,s&&(f=n.left+50,g=n.top+25);var t=new fabric.Line([f,g,f,g],{stroke:"#81a2be",id:b.currObjectId++,selectable:!1,strokeWidth:3}),u=new fabric.Line([f,g,f,g],{stroke:"#81a2be",id:b.currObjectId++,selectable:!1,strokeWidth:3}),v=new fabric.Line([f,g,f,g],{stroke:"#81a2be",id:b.currObjectId++,selectable:!0,hasControls:!1,strokeWidth:3});c={element:t,type:a.TYPES.HORIZONTAL_LINE,outputs:[],inputs:[]},d={element:u,type:a.TYPES.HORIZONTAL_LINE,outputs:[],inputs:[]},e={element:v,type:a.TYPES.VERTICAL_LINE,y1:g,y2:g,outputs:[],inputs:[]},b.canvas.add(t),b.canvas.add(u),b.canvas.add(v),s?(c.inputs.push(b.objects[b.currTab][m].element.id),c.outputs=[e.element.id],e.inputs.push(c.element.id),e.outputs=[d.element.id],d.inputs.push(e.element.id),b.objects[b.currTab][m].outputs.push(c.element.id)):(c.outputs=[b.objects[b.currTab][m].element.id],e.outputs=[c.element.id],d.outputs=[e.element.id],b.objects[b.currTab][m].inputs.push(c.element.id),c.inputs.push(e.element.id),e.inputs.push(d.element.id)),b.generateTruthTable()}}}}}}(Constants,Main),Api=function(a,b){var c=100,d=function(d,e,f){for(var g,h=[],i=c,j=0;j<d.length;j++)if("("==d[j])h.push(d[j]);else if(")"==d[j]){var k=i++;for(e[k]={id:b.currObjectId,inputs:[]},b.objects[f][b.currObjectId]={element:null,type:null,outputs:[],inputs:[],top:null,left:null,width:a.OPTS.gridSize,height:a.OPTS.gridSize,state:a.STATES.INPUT_OFF},b.currObjectId++;"("!=h[h.length-1];){if("*"==h[h.length-1]||"+"==h[h.length-1])g=h[h.length-1];else if("!"==h[h.length-1]){var l=prevInput+1;e[l]||(e[l]={id:b.currObjectId,inputs:[prevInput]},b.objects[f][b.currObjectId]={element:null,type:a.TYPES.NOT_GATE,outputs:[],inputs:[],top:null,left:null,width:a.OPTS.gridSize,height:a.OPTS.gridSize,state:a.STATES.INPUT_OFF},b.currObjectId++),e[k].inputs.push(l)}else{var m=parseInt(h[h.length-1]);100>m&&(m*=2,e[m]||(e[m]={id:b.currObjectId,inputs:[]},b.objects[f][b.currObjectId]={element:null,type:a.TYPES.INPUT_GATE,outputs:[],inputs:[],top:null,left:null,width:a.OPTS.gridSize,height:a.OPTS.gridSize,state:a.STATES.INPUT_OFF},b.currObjectId++)),prevInput=m,"!"!=h[h.length-2]&&e[k].inputs.push(m)}h.pop()}"*"==g?b.objects[f][e[k].id].type=a.TYPES.AND_GATE:b.objects[f][e[k].id].type=a.TYPES.OR_GATE,h.pop(),h.push(k)}else h.push(d[j]);return i-1},e=function(a,b,c){a[b].depth||(a[b].depth=0),a[b].depth=Math.max(a[b].depth,c);for(var d=0;d<a[b].inputs.length;d++)e(a,a[b].inputs[d],c+1)},f=function(c,d,e,g,h){for(var i=c[d].inputs,j=c[d].id,k=0;k<i.length;k++)f(c,i[k],e,g+1,h);if(!b.objects[h][j].element&&c[d].depth==g){var l=500-100*g,m=0+50*e[g];b.objects[h][j].top=m,b.objects[h][j].left=l,e[g]++,b.objects[h][j].element=new Object,fabric.Image.fromURL(a.GATES[b.objects[h][j].type].url,function(a){b.objects[h][a.id].element=a},{id:j,top:m,left:l,height:a.OPTS.gridSize,width:50,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1}),e[g]++}},g=function(a,c,d){if(!a[c].vis){for(var e=a[c].id,f=a[c].inputs,h=0;h<f.length;h++){var i=a[f[h]].id;b.wireObjects(e,i,d),g(a,f[h],d)}a[c].vis=!0}},h={};return h.parseString=function(c,h){for(var i={},j=[],k=0;100>k;k++)j.push(0);var l=d(c,i,h);e(i,l,0),f(i,l,j,0,h),g(i,l,h),fabric.Image.fromURL(a.GATES[a.TYPES.OUTPUT_GATE].url,function(c){b.objects[h][c.id]={element:c,type:a.TYPES.OUTPUT_GATE,outputs:[],inputs:[],top:50,left:600,state:a.STATES.OFF},b.wireObjects(c.id,i[l].id,h),addAllCanvasObjects(h),b.generateTruthTable(),b.updateCost()},{id:b.currObjectId++,top:50,left:600,height:50,width:50,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1})},h.getMinimize=function(a){var c=b.generateTruthTable();$.ajax({url:"/kmap",datatype:"json",data:JSON.stringify(c),type:"POST",success:function(b){console.log(b),h.parseString(b,a)},error:function(a){console.log(a)}})},h.importPhoto=function(a,b){$.ajax({type:"POST",url:"/scan",data:a,contentType:!1,cache:!1,processData:!1,async:!1,success:function(a){h.parseString(a,b)}})},h}(Constants,Main),Ui=function(a,b,c){var d=2,e={};return e.addTab=function(){var a=$("div[id^='tab-']").length;$("#tabs .tab.active").removeClass("active"),$("#tabs").append("<div id='tab-"+a+"' class='active tab'><span>Tab "+d+"</span><button id='delete-tab-"+a+'\'><i class="el el-remove"></i></button></div>'),removeAllCanvasObjects(b.currTab),b.objects.push({}),d++},e.deleteTabOnClick=function(a){var c=parseInt($(this).attr("id").split("-")[2]);removeAllObjects(c),b.objects.splice(c,1),$(this).parent().remove();for(var e=c;e<b.objects.length;e++)$("#tabs .tab").eq(e).attr("id","tab-"+e).find("button").attr("id","delete-tab-"+e);0==b.objects.length&&(b.objects.push({}),$("#tabs").append("<div id='tab-0' class='active tab'><span>Tab "+d+"</span><button id='delete-tab-0'><i class=\"el el-remove\"></i></button></div>"),d++),c==b.objects.length&&c--,$("div[id='tab-"+c+"']").addClass("active"),b.currTab=c,addAllCanvasObjects(b.currTab)},e.tabOnClick=function(a){if(!$(a.target).is("button")&&!$(a.target).is("i")){var c=parseInt($(this).attr("id").split("-")[1]);$("#tabs .tab.active").removeClass("active"),$("div[id='tab-"+c+"']").addClass("active"),removeAllCanvasObjects(b.currTab),addAllCanvasObjects(c),b.currTab=c,b.generateTruthTable(),b.updateCost()}},e.simplifyButtonOnClick=function(){e.addTab(),c.getMinimize(b.objects.length-1),b.currTab=b.objects.length-1},e.exportButtonOnClick=function(){$("#export-modal").css("display","block")},e.exportExitOnClick=function(){$("#export-modal").css("display","none")},e.cameraButtonOnClick=function(){$("#camera-modal").css("display","block")},e.cameraExitOnClick=function(){$("#camera-modal").css("display","none")},e.cameraImportOnClick=function(a){a.preventDefault();var d=new FormData;d.append("file",$("#camera-modal-textarea")[0].files[0]),e.addTab(),c.importPhoto(d,b.objects.length-1),b.currTab=b.objects.length-1,$("#camera-modal").css("display","none");var f=$("#camera-modal-textarea");f.replaceWith(f=f.clone(!0))},e.importButtonOnClick=function(){$("#import-modal").css("display","block")},e.importExitOnClick=function(){$("#import-modal").css("display","none")},e.importImportOnClick=function(){removeAllCanvasObjects(b.currTab),delete b.objects,b.currTab=0,b.objects=JSON.parse($("#import-modal-textarea").val());for(var c=0;c<b.objects.length;c++)for(var e in b.objects[c]){var f=c,g=b.objects[f][e].element;if("image"==g.type){var h=b.objects[f][e].type==a.TYPES.INPUT_GATE?a.STATES.INPUT_OFF:g.src;fabric.Image.fromURL(h,function(c){b.objects[c.tab][c.id].element=c,b.objects[c.tab][c.id].state=a.STATES.INPUT_OFF,c.tab==b.currTab&&b.canvas.add(c)},{id:e,tab:f,top:g.top,left:g.left,height:g.height,width:g.width,hasBorders:!1,hasControls:!1,hasRotatingPoint:!1})}else b.objects[f][e].type==a.TYPES.HORIZONTAL_LINE?(b.objects[f][e].element=new fabric.Line([b.objects[f][e].x1,b.objects[f][e].y1,b.objects[f][e].x2,b.objects[f][e].y2],{stroke:"#81a2be",selectable:!1,id:e,strokeWidth:3}),f==b.currTab&&b.canvas.add(b.objects[f][e].element)):b.objects[f][e].type==a.TYPES.VERTICAL_LINE&&(b.objects[f][e].element=new fabric.Line([b.objects[f][e].x1,b.objects[f][e].y1,b.objects[f][e].x2,b.objects[f][e].y2],{stroke:"#81a2be",selectable:!0,hasControls:!1,y1:b.objects[f][e].y1,y2:b.objects[f][e].y2,id:e,strokeWidth:3}),f==b.currTab&&b.canvas.add(b.objects[f][e].element));b.currObjectId=Math.max(b.currObjectId,e+1)}$("div[id^='tab-']").remove(),d=1;for(var c=0;c<b.objects.length;c++)0==c?$("#tabs").append("<div id='tab-"+c+"' class='active tab'><span>Imported "+d+"</span><button id='delete-tab-"+c+'\'><i class="el el-remove"></i></button></div>'):$("#tabs").append("<div id='tab-"+c+"' class='tab'><span>Imported "+d+"</span><button id='delete-tab-"+c+'\'><i class="el el-remove"></i></button></div>'),d++;d=1,$("#import-modal").css("display","none"),setTimeout(function(){b.generateTruthTable(),b.updateOutputs(),b.updateCost()},500)},e}(Constants,Main,Api);$(function(){window.onkeydown=function(a){var b=a.keyCode?a.keyCode:a.which;8==b&&(isDeleting=!0)},window.onkeyup=function(a){var b=a.keyCode?a.keyCode:a.which;8==b&&(isDeleting=!1)},$(document).ready(function(){Main.initApp(),Main.canvas.on("mouse:over",CanvasEvents.onMouseOver),Main.canvas.on("mouse:up",CanvasEvents.onMouseUp),Main.canvas.on("object:moving",CanvasEvents.onObjectMoving),Main.canvas.on("mouse:move",CanvasEvents.onMouseMove),Main.canvas.on("mouse:down",CanvasEvents.onMouseDown),$("#add-tab").click(Ui.addTab),$("body").on("click","button[id^='delete-tab']",Ui.deleteTabOnClick),$("body").on("click","div[id^='tab-']",Ui.tabOnClick),$("#simplify-button").click(Ui.simplifyButtonOnClick),$("#export-button").click(Ui.exportButtonOnClick),$("#export-exit-button").click(Ui.exportExitOnClick),$("#camera-button").click(Ui.cameraButtonOnClick),$("#camera-exit-button").click(Ui.cameraExitOnClick),$("#camera-import-button").click(Ui.cameraImportOnClick),$("#import-button").click(Ui.importButtonOnClick),$("#import-exit-button").click(Ui.importExitOnClick),$("#import-import-button").click(Ui.importImportOnClick)})});